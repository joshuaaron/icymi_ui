<div class="wrapper">
  <div class="position-display">
    <code>
      position-area: <span class="value">top right</span>;
    </code>
  </div>

  <div class="anchor-demo">
    <input type="radio" name="position" id="pos-top-left" value="top left">
    <input type="radio" name="position" id="pos-top-center" value="top center">
    <input type="radio" name="position" id="pos-top-right" value="top right" checked>
    <input type="radio" name="position" id="pos-center-left" value="center left">
    <input type="radio" name="position" id="pos-center-center" value="center">
    <input type="radio" name="position" id="pos-center-right" value="center right">
    <input type="radio" name="position" id="pos-bottom-left" value="bottom left">
    <input type="radio" name="position" id="pos-bottom-center" value="bottom center">
    <input type="radio" name="position" id="pos-bottom-right" value="bottom right">
    <div class="demo-container">
      <label for="pos-top-left">
        <span class="imcb-label">inset-modified containing block</span>
      </label>
      <label for="pos-top-center">
        <span class="imcb-label">inset-modified containing block</span>
      </label>
      <label for="pos-top-right">
        <span class="imcb-label">inset-modified containing block</span>
      </label>
      <label for="pos-center-left">
        <span class="imcb-label">inset-modified containing block</span>
      </label>
      <label for="pos-center-center" class="anchor-cell">
        <span class="anchor-label">anchor</span>
      </label>
      <label for="pos-center-right">
        <span class="imcb-label">inset-modified containing block</span>
      </label>
      <label for="pos-bottom-left">
        <span class="imcb-label">inset-modified containing block</span>
      </label>
      <label for="pos-bottom-center">
        <span class="imcb-label">inset-modified containing block</span>
      </label>
      <label for="pos-bottom-right">
        <span class="imcb-label">inset-modified containing block</span>
      </label>

      <span class="positioned">target</span>
      <span class="containing-block-label">containing block</span>
    </div>
  </div>

  <div class="control-wrapper">
    <div class="checkbox-control">
      <label class="toggle-checkbox">
        <input type="checkbox" id="show-controls">
        <span class="checkmark"></span>
        <span class="label-text">show alignment controls</span>
      </label>
    </div>

    <div class="controls">
      <label>
        <span
          ><code>justify-self:</code></span
        >
        <select id="justify-self-select">
          <button>
            <selectedcontent></selectedcontent>
          </button>
          <option value="auto">auto</option>
          <option value="start">start</option>
          <option value="center">center</option>
          <option value="end">end</option>
          <option value="stretch">stretch</option>
        </select>
      </label>
      <label>
        <span
          ><code>align-self</code>:</span
        >
        <select id="align-self-select">
          <button>
            <selectedcontent></selectedcontent>
          </button>
          <option value="auto">auto</option>
          <option value="start">start</option>
          <option value="center">center</option>
          <option value="end">end</option>
          <option value="stretch">stretch</option>
        </select>
      </label>
    </div>
  </div>
</div>

<style>
  .position-display {
    display: flex;
    justify-content: center;
    margin-block-end: 1rem;

    .value {
      color: var(--display-value);
      font-weight: 600;
    }
  }
  .controls {
    display: none;
    justify-content: end;

    label {
      text-align: right;
    }
  }
  select {
    border: none;

    &,
    &::picker(select) {
      appearance: base-select;
    }

    &::picker(select) {
      background: rgba(255, 255, 255, 0.51);
      border: 1px solid rgba(55, 55, 55, 0.3);
      backdrop-filter: blur(15px);
      min-inline-size: 14ch;
      border-radius: 4px;
      padding: 2px;
      /* gap: 4rem; */
    }

    &::picker-icon {
      color: var(--display-value);
      transition: rotate 0.2s ease-out;
    }

    &:open::picker-icon {
      rotate: 180deg;
    }

    selectedcontent {
      align-items: start;
      min-inline-size: 10ch;
      font-size: 14px;
      color: var(--display-value);
      font-weight: 600;
    }

    option {
      font-size: 14px;
    }
  }
  .wrapper {
    display: flex;
    flex-direction: column;
  }

  .anchor-demo {
    & input[type="radio"] {
      position: absolute;
      opacity: 0;
      pointer-events: none;
    }
  }

  .demo-container {
    anchor-name: --container;
    position: relative;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(3, 120px);
    background: var(--demo-block-bg);
    border-radius: 8px;

    & label {
      border: var(--border-base);
      cursor: pointer;
      position: relative;
      transition: background 0.15s;

      &:not(.anchor-cell):hover {
        background: color-mix(in srgb, var(--anchor) 15%, white 85%);
      }
    }
  }

  /* "inset-modified containing block" label - hidden by default */
  .imcb-label {
    display: none;
    font-family: monospace;
    font-size: 0.7rem;
    padding: 0.5rem;
    color: #333;
  }

  .anchor-cell {
    anchor-name: --anchor;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #fdbc5a;
    font-size: 1.25rem;
  }

  .anchor-label {
    color: #333;
  }

  .positioned {
    position: absolute;
    position-anchor: --anchor;
    background: var(--target);
    color: white;
    padding: 0.75rem 1rem;
    border-radius: 4px;
    text-align: center;
    line-height: 1.3;

    & small {
      display: block;
      font-weight: 400;
      font-size: 0.75rem;
      opacity: 0.9;
      font-family: monospace;
    }
  }

  /* Containing block label */
  .containing-block-label {
    position: absolute;
    bottom: 5px;
    left: 5px;
    margin-block-start: 0.25rem;
    font-family: monospace;
    font-size: 0.8rem;
    color: #333;
  }

  /* Position states */
  .anchor-demo:has(#pos-top-left:checked) .positioned {
    position-area: top left;
  }
  .anchor-demo:has(#pos-top-center:checked) .positioned {
    position-area: top center;
  }
  .anchor-demo:has(#pos-top-right:checked) .positioned {
    position-area: top right;
  }
  .anchor-demo:has(#pos-center-left:checked) .positioned {
    position-area: center left;
  }
  .anchor-demo:has(#pos-center-center:checked) .positioned {
    position-area: center;
  }
  .anchor-demo:has(#pos-center-right:checked) .positioned {
    position-area: center right;
  }
  .anchor-demo:has(#pos-bottom-left:checked) .positioned {
    position-area: bottom left;
  }
  .anchor-demo:has(#pos-bottom-center:checked) .positioned {
    position-area: bottom center;
  }
  .anchor-demo:has(#pos-bottom-right:checked) .positioned {
    position-area: bottom right;
  }

  /* Show label and highlight selected cell */
  .anchor-demo:has(#pos-top-left:checked) label[for="pos-top-left"],
  .anchor-demo:has(#pos-top-center:checked) label[for="pos-top-center"],
  .anchor-demo:has(#pos-top-right:checked) label[for="pos-top-right"],
  .anchor-demo:has(#pos-center-left:checked) label[for="pos-center-left"],
  .anchor-demo:has(#pos-center-center:checked) label[for="pos-center-center"],
  .anchor-demo:has(#pos-center-right:checked) label[for="pos-center-right"],
  .anchor-demo:has(#pos-bottom-left:checked) label[for="pos-bottom-left"],
  .anchor-demo:has(#pos-bottom-center:checked) label[for="pos-bottom-center"],
  .anchor-demo:has(#pos-bottom-right:checked) label[for="pos-bottom-right"] {
    background: var(--imcb);

    & .imcb-label {
      display: block;
    }
  }

  /* CHECKBOX */
  .control-wrapper {
    margin-block: 0.5rem;
    display: flex;
    align-items: start;
    justify-content: space-between;
  }

  .checkbox-control {
    padding-block: 0.4rem;
  }

  .toggle-checkbox {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-family: monospace;
    font-size: 0.875rem;
    color: white;
    cursor: pointer;
    user-select: none;
  }

  .toggle-checkbox input {
    position: absolute;
    opacity: 0;
    pointer-events: none;
  }

  .checkmark {
    width: 1rem;
    height: 1rem;
    border: 1px solid white;
    border-radius: 3px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: 0.2s ease;
  }

  .toggle-checkbox input:checked + .checkmark {
    border-color: var(--form-control);
  }
  /* White checkmark when checked */
  .toggle-checkbox input:checked + .checkmark::after {
    content: "";
    width: 4px;
    height: 8px;
    border: solid var(--form-control);
    border-width: 0 2px 2px 0;
    transform: rotate(45deg) translate(-1px, -1px);
  }

  .toggle-checkbox:hover .checkmark {
    border-color: color-mix(in srgb, var(--primary-theme) 65%, white 15%);
  }

  .label-text {
    opacity: 0.9;
  }
</style>

<script>
  const valueEl = document.querySelector(".position-display .value");
  const radios = Array.from(
    document.querySelectorAll('input[name="position"]'),
  ) as HTMLInputElement[];
  radios.forEach((radio) => {
    radio.addEventListener("change", () => {
      if (valueEl) {
        valueEl.textContent = radio.value;
      }
    });
  });

  const positioned = document.querySelector(".positioned") as HTMLElement;
  const justifySelect = document.getElementById("justify-self-select") as HTMLSelectElement;
  const alignSelect = document.getElementById("align-self-select") as HTMLSelectElement;

  justifySelect?.addEventListener("change", () => {
    positioned.style.justifySelf = justifySelect.value;
  });

  alignSelect?.addEventListener("change", () => {
    positioned.style.alignSelf = alignSelect.value;
  });

  const showControlsCheckbox = document.getElementById("show-controls") as HTMLInputElement;
  const controls = document.querySelector(".controls") as HTMLElement;

  showControlsCheckbox?.addEventListener("change", () => {
    controls.style.display = showControlsCheckbox.checked ? "grid" : "none";
  });
</script>
